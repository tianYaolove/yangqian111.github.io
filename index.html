<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="嘘_sheep">
<meta property="og:type" content="website">
<meta property="og:title" content="嘘_sheep">
<meta property="og:url" content="http://sheep.com/index.html">
<meta property="og:site_name" content="嘘_sheep">
<meta property="og:description" content="嘘_sheep">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="嘘_sheep">
<meta name="twitter:description" content="嘘_sheep">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://sheep.com/"/>


  <title> 嘘_sheep </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?4fa2aea1f41359883e5d92b5cb8bccb8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">嘘_sheep</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/01/iOS-UITableView上下滑动控制底部按钮出现/" itemprop="url">
                  iOS UITableView上下滑动控制底部按钮出现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-01T16:01:51+08:00" content="2016-11-01">
              2016-11-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS-基础/" itemprop="url" rel="index">
                    <span itemprop="name">iOS 基础</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/01/iOS-UITableView上下滑动控制底部按钮出现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/01/iOS-UITableView上下滑动控制底部按钮出现/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/11/01/iOS-UITableView上下滑动控制底部按钮出现/" class="leancloud_visitors" data-flag-title="iOS UITableView上下滑动控制底部按钮出现">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一个简单的小功能，忘记在哪个APP上看到过，就做来玩一玩  实现起来还是很简单的 </p>
<p>先看一下效果</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/UITableView%20Scroll.gif" alt="1"></p>
<p>分析一下我们需要实现的：</p>
<ul>
<li>UITableView 向上滑动时隐藏底部的按钮</li>
<li>UITableView 向下滑动时，底部按钮出现</li>
<li>UITableView 到达底部时，底部按钮也出现</li>
</ul>
<p>创建工程啥的我都不讲了吧</p>
<p>在viewDidload中加上view</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//加上这句  UIScrollView的Content就不会自动偏移64(导航栏和状态栏的高度)</div><div class="line">    self.automaticallyAdjustsScrollViewInsets = NO;</div><div class="line">    </div><div class="line">    UITableView *tableView = [[UITableView alloc] initWithFrame:CGRectMake(0, 64, SCREEN.width, SCREEN.height-64) style:UITableViewStylePlain];</div><div class="line">    tableView.delegate = self;</div><div class="line">    tableView.dataSource = self;</div><div class="line">    [self.view addSubview:tableView];</div><div class="line">    self.tableView = tableView;</div><div class="line">    [self.tableView registerClass:[UITableViewCell class] forCellReuseIdentifier:@&quot;cell&quot;];</div><div class="line">    </div><div class="line">    UIButton *btn = [UIButton buttonWithType:UIButtonTypeCustom];</div><div class="line">    btn.frame = CGRectMake(self.view.frame.size.width / 2 - 25, self.view.frame.size.height - 50, 50, 50);</div><div class="line">    [btn setBackgroundImage:[UIImage imageNamed:@&quot;comments&quot;] forState:UIControlStateNormal];</div><div class="line">    self.btn = btn;</div><div class="line">    [self.view addSubview:self.btn];</div></pre></td></tr></table></figure>
<p>处理UIScrollView的滑动，一般都是在scrollViewDidScroll:方法中，这次也不例外</p>
<p>我们在这里监听当前scrollview的滑动距离 滑动方向等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#pragma mark - UITableView delegate</div><div class="line">-(void)scrollViewDidScroll:(UIScrollView *)scrollView&#123;</div><div class="line">    if (scrollView.contentOffset.y &gt; self.offsetY &amp;&amp; scrollView.contentOffset.y &gt; 0) &#123;//向上滑动</div><div class="line">        //按钮消失</div><div class="line">        [UIView transitionWithView:self.btn duration:0.1 options:UIViewAnimationOptionTransitionNone animations:^&#123;</div><div class="line">            self.btn.frame = CGRectMake(SCREEN.width / 2 - 25, SCREEN.height, 50, 50);</div><div class="line">        &#125; completion:NULL];</div><div class="line">    &#125;else if (scrollView.contentOffset.y &lt; self.offsetY )&#123;//向下滑动</div><div class="line">        //按钮出现</div><div class="line">        [UIView transitionWithView:self.btn duration:0.1 options:UIViewAnimationOptionTransitionNone animations:^&#123;</div><div class="line">            self.btn.frame = CGRectMake(SCREEN.width / 2 - 25, SCREEN.height - 50, 50, 50);</div><div class="line">        &#125; completion:NULL];</div><div class="line">    &#125;</div><div class="line">    self.offsetY = scrollView.contentOffset.y;//将当前位移变成缓存位移</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样一个  特别简单的小功能  就实现了 </p>
<p>源码放在了：</p>
<p><a href="https://github.com/yangqian111/blog/tree/master/iOS%20UITableView上下滑动控制底部按钮出现" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/iOS%20UITableView上下滑动控制底部按钮出现</a></p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/31/iOS-UIScrollView上滑隐藏UINavigationBar/" itemprop="url">
                  iOS UIScrollView上滑隐藏UINavigationBar
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-31T16:16:27+08:00" content="2016-10-31">
              2016-10-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS-基础/" itemprop="url" rel="index">
                    <span itemprop="name">iOS 基础</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/31/iOS-UIScrollView上滑隐藏UINavigationBar/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/31/iOS-UIScrollView上滑隐藏UINavigationBar/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/31/iOS-UIScrollView上滑隐藏UINavigationBar/" class="leancloud_visitors" data-flag-title="iOS UIScrollView上滑隐藏UINavigationBar">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们经常看到一些阅读类的应用，上滑UIScrollView的时候  UINavigationBar就隐藏了  虽然Apple给我们提供了隐藏NavigationBar的方法，但是有一个弊端  就是navigationbar不能随着UIScrollView的滑动速度来隐藏，并且设置bar逐渐隐藏，今天我们就来实现这样一个效果</p>
<p>首先看一下效果</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/ScrollView.gif" alt="1"></p>
<p><strong>首先分析一下，随着滑动隐藏NavigationBar，肯定是在UIScrollView的delegate方法scrollViewDidScroll:做操作</strong></p>
<h3 id="UINavigationBar-Category"><a href="#UINavigationBar-Category" class="headerlink" title="UINavigationBar Category"></a>UINavigationBar Category</h3><p>在UINavigationBar中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@interface UINavigationBar (PPSNavigationBar)</div><div class="line">/**</div><div class="line"> 设置scrollview的透明度 随着滑动  透明度改变</div><div class="line"></div><div class="line"> @param alpha 透明度</div><div class="line"> */</div><div class="line">- (void)pps_setScrollViewAlpha:(CGFloat)alpha;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> 设置Bar偏移</div><div class="line"></div><div class="line"> @param translationY 偏移量</div><div class="line"> */</div><div class="line">- (void)pps_setTranslationY:(CGFloat)translationY;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">@implementation UINavigationBar (PPSNavigationBar)</div><div class="line"></div><div class="line">-(void)pps_setTranslationY:(CGFloat)translationY&#123;</div><div class="line">    self.transform = CGAffineTransformMakeTranslation(0, translationY);</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)pps_setScrollViewAlpha:(CGFloat)alpha&#123;</div><div class="line">    [[self valueForKey:@&quot;_leftViews&quot;] enumerateObjectsUsingBlock:^(UIView *view, NSUInteger i, BOOL *stop) &#123;</div><div class="line">        view.alpha = alpha;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [[self valueForKey:@&quot;_rightViews&quot;] enumerateObjectsUsingBlock:^(UIView *view, NSUInteger i, BOOL *stop) &#123;</div><div class="line">        view.alpha = alpha;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    UIView *titleView = [self valueForKey:@&quot;_titleView&quot;];</div><div class="line">    titleView.alpha = alpha;</div><div class="line">    </div><div class="line">    [[self subviews] enumerateObjectsUsingBlock:^(UIView *obj, NSUInteger idx, BOOL *stop) &#123;</div><div class="line">        if ([obj isKindOfClass:NSClassFromString(@&quot;UINavigationItemView&quot;)]) &#123;</div><div class="line">            obj.alpha = alpha;</div><div class="line">            *stop = YES;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>实现起来很简单   </p>
<p>在NavigationBar中 </p>
<ul>
<li>_leftViews</li>
<li>_rightViews</li>
<li>_titleView</li>
<li>UINavigationItemView </li>
</ul>
<p>这几个属性都是UINavigationBar的属性，如果不知道这几个属性  是可以通过runtime得到这几个属性的 </p>
<p>具体的实现方法参考我的另一篇文章：</p>
<p><a href="http://ppsheep.com/2016/10/31/iOS-RunTime解析/" target="_blank" rel="external">http://ppsheep.com/2016/10/31/iOS-RunTime解析/</a></p>
<p>通过几个属性名我们就能知道 代表什么</p>
<p>然后在我们的viewcontroller中  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">-(void)scrollViewDidScroll:(UIScrollView *)scrollView&#123;</div><div class="line">	//这里加上64是为了得到准确的scrollview的偏移量  当然你也可以在下面的判断中计算</div><div class="line">    CGFloat offsetY = scrollView.contentOffset.y+64;</div><div class="line">    if (offsetY &gt; 0) &#123;</div><div class="line">        if (offsetY &gt;= 44) &#123;</div><div class="line">            [self setNavigationBarTransformProgress:1];</div><div class="line">        &#125; else &#123;</div><div class="line">            [self setNavigationBarTransformProgress:(offsetY/44)];</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        [self setNavigationBarTransformProgress:0];</div><div class="line">        self.navigationController.navigationBar.backIndicatorImage = [UIImage new];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setNavigationBarTransformProgress:(CGFloat)progress</div><div class="line">&#123;</div><div class="line">    [self.navigationController.navigationBar pps_setTranslationY:(-44 * progress)];</div><div class="line">    [self.navigationController.navigationBar pps_setScrollViewAlpha:(1-progress)];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实现起来 还是很简单的</p>
<p>源工程：</p>
<p><a href="https://github.com/yangqian111/blog/tree/master/iOS%20UIScrollView上滑隐藏UINavigationBar" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/iOS%20UIScrollView上滑隐藏UINavigationBar</a></p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/31/iOS-RunTime解析/" itemprop="url">
                  iOS RunTime解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-31T10:07:16+08:00" content="2016-10-31">
              2016-10-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS进阶/" itemprop="url" rel="index">
                    <span itemprop="name">iOS进阶</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/31/iOS-RunTime解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/31/iOS-RunTime解析/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/31/iOS-RunTime解析/" class="leancloud_visitors" data-flag-title="iOS RunTime解析">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>RunTime一直是iOS开发中非常重要的而且必须要理解的东西，最近在学习RunTime，有自己的一些心得，现在记录下来，便于以后查阅</strong></p>
<h3 id="什么是RunTime"><a href="#什么是RunTime" class="headerlink" title="什么是RunTime"></a>什么是RunTime</h3><ul>
<li>我们写的代码在程序运行过程中都会被转化成runtime的C代码执行，例如[target doSomething]方法会被转化成 objc_msgSend(target,@select(doSomething))</li>
<li>OC中的一切都被设计成对象，我们都知道一个类被初始化成一个实例，这个实例是一个对象，在runtime中使用结构体表示</li>
<li>相关的定义:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/// 描述类中的一个方法</div><div class="line">typedef struct objc_method *Method;</div><div class="line"></div><div class="line">/// 实例变量</div><div class="line">typedef struct objc_ivar *Ivar;</div><div class="line"></div><div class="line">/// 类别Category</div><div class="line">typedef struct objc_category *Category;</div><div class="line"></div><div class="line">/// 类中声明的属性</div><div class="line">typedef struct objc_property *objc_property_t;</div></pre></td></tr></table></figure>
<ul>
<li>类在RunTime中的表示：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//类在runtime中的表示</div><div class="line"> struct objc_class &#123;</div><div class="line">     Class isa;//指针，顾名思义，表示是一个什么，</div><div class="line">     //实例的isa指向类对象，类对象的isa指向元类</div><div class="line"></div><div class="line"> #if !__OBJC2__</div><div class="line">     Class super_class;  //指向父类</div><div class="line">     const char *name;  //类名</div><div class="line">     long version;</div><div class="line">     long info;</div><div class="line">     long instance_size</div><div class="line">     struct objc_ivar_list *ivars //成员变量列表</div><div class="line">     struct objc_method_list **methodLists; //方法列表</div><div class="line">     struct objc_cache *cache;//缓存</div><div class="line">     //一种优化，调用过的方法存入缓存列表，下次调用先找缓存</div><div class="line">     struct objc_protocol_list *protocols //协议列表</div><div class="line">     #endif</div><div class="line"> &#125; OBJC2_UNAVAILABLE;</div><div class="line"> /* Use `Class` instead of `struct objc_class *` */</div></pre></td></tr></table></figure>
<h3 id="获取类中的属性方法列表等"><a href="#获取类中的属性方法列表等" class="headerlink" title="获取类中的属性方法列表等"></a>获取类中的属性方法列表等</h3><p>有时候我们有这样的需求，需要知道当前类中的每个属性的名字</p>
<p>我们可以通过runtime的一系列方法获取类的一些信息(包括属性列表，方法列表，成员变量列表，和遵循的协议列表)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">unsigned int count;</div><div class="line">//获取属性列表</div><div class="line">objc_property_t *propertyList = class_copyPropertyList([self class], &amp;count);</div><div class="line">for (unsigned int i=0; i&lt;count; i++) &#123;</div><div class="line">    const char *propertyName = property_getName(propertyList[i]);</div><div class="line">    NSLog(@&quot;property----&gt;%@&quot;, [NSString stringWithUTF8String:propertyName]);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//获取方法列表</div><div class="line">Method *methodList = class_copyMethodList([self class], &amp;count);</div><div class="line">for (unsigned int i; i&lt;count; i++) &#123;</div><div class="line">    Method method = methodList[i];</div><div class="line">    NSLog(@&quot;method----&gt;%@&quot;, NSStringFromSelector(method_getName(method)));</div><div class="line">&#125;</div><div class="line"></div><div class="line">//获取成员变量列表</div><div class="line">Ivar *ivarList = class_copyIvarList([self class], &amp;count);</div><div class="line">for (unsigned int i; i&lt;count; i++) &#123;</div><div class="line">    Ivar myIvar = ivarList[i];</div><div class="line">    const char *ivarName = ivar_getName(myIvar);</div><div class="line">    NSLog(@&quot;Ivar----&gt;%@&quot;, [NSString stringWithUTF8String:ivarName]);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//获取协议列表</div><div class="line">__unsafe_unretained Protocol **protocolList = class_copyProtocolList([self class], &amp;count);</div><div class="line">for (unsigned int i; i&lt;count; i++) &#123;</div><div class="line">    Protocol *myProtocal = protocolList[i];</div><div class="line">    const char *protocolName = protocol_getName(myProtocal);</div><div class="line">    NSLog(@&quot;protocol----&gt;%@&quot;, [NSString stringWithUTF8String:protocolName]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下 新建一个工程</p>
<p>在.h文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface ViewController : UIViewController&lt;UITabBarDelegate&gt;</div><div class="line"></div><div class="line">@property (nonatomic, copy) NSString *property1;</div><div class="line">@property (nonatomic, copy) NSString *property2;</div><div class="line">@property (nonatomic, copy) NSString *property3;</div><div class="line">@property (nonatomic, copy) NSString *property4;</div><div class="line"></div><div class="line">- (void)testGetMethods;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>在.m文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@interface ViewController ()&lt;UINavigationBarDelegate&gt;</div><div class="line">&#123;</div><div class="line">    @private</div><div class="line">    NSUInteger countTest;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@property (nonatomic, copy) NSString *property5;</div><div class="line">@property (nonatomic, copy) NSString *property6;</div><div class="line">@property (nonatomic, copy) NSString *property7;</div><div class="line">@property (nonatomic, copy) NSString *property8;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    [self getProperties];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)getProperties&#123;</div><div class="line">    unsigned int count;</div><div class="line">    //获取属性列表</div><div class="line">    NSLog(@&quot;----------获取属性---------&quot;);</div><div class="line">    objc_property_t *propertyList = class_copyPropertyList([self class], &amp;count);</div><div class="line">    for (unsigned int i=0; i&lt;count; i++) &#123;</div><div class="line">        const char *propertyName = property_getName(propertyList[i]);</div><div class="line">        NSLog(@&quot;property----&gt;%@&quot;, [NSString stringWithUTF8String:propertyName]);</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;----------获取方法---------&quot;);</div><div class="line">    //获取方法列表</div><div class="line">    Method *methodList = class_copyMethodList([self class], &amp;count);</div><div class="line">    for (unsigned int i; i&lt;count; i++) &#123;</div><div class="line">        Method method = methodList[i];</div><div class="line">        NSLog(@&quot;method----&gt;%@&quot;, NSStringFromSelector(method_getName(method)));</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;----------获取成员变量---------&quot;);</div><div class="line">    //获取成员变量列表</div><div class="line">    Ivar *ivarList = class_copyIvarList([self class], &amp;count);</div><div class="line">    for (unsigned int i; i&lt;count; i++) &#123;</div><div class="line">        Ivar myIvar = ivarList[i];</div><div class="line">        const char *ivarName = ivar_getName(myIvar);</div><div class="line">        NSLog(@&quot;Ivar----&gt;%@&quot;, [NSString stringWithUTF8String:ivarName]);</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;----------获取协议---------&quot;);</div><div class="line">    //获取协议列表</div><div class="line">    __unsafe_unretained Protocol **protocolList = class_copyProtocolList([self class], &amp;count);</div><div class="line">    for (unsigned int i; i&lt;count; i++) &#123;</div><div class="line">        Protocol *myProtocal = protocolList[i];</div><div class="line">        const char *protocolName = protocol_getName(myProtocal);</div><div class="line">        NSLog(@&quot;protocol----&gt;%@&quot;, [NSString stringWithUTF8String:protocolName]);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)testGetMethods&#123;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)didReceiveMemoryWarning &#123;</div><div class="line">    [super didReceiveMemoryWarning];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>运行一下  我们看输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">2016-10-31 10:34:15.698751 iOS RunTime解析[1023:187762] ----------获取属性---------</div><div class="line">2016-10-31 10:34:15.698886 iOS RunTime解析[1023:187762] property----&gt;property5</div><div class="line">2016-10-31 10:34:15.698950 iOS RunTime解析[1023:187762] property----&gt;property6</div><div class="line">2016-10-31 10:34:15.698999 iOS RunTime解析[1023:187762] property----&gt;property7</div><div class="line">2016-10-31 10:34:15.699046 iOS RunTime解析[1023:187762] property----&gt;property8</div><div class="line">2016-10-31 10:34:15.699160 iOS RunTime解析[1023:187762] property----&gt;property1</div><div class="line">2016-10-31 10:34:15.699211 iOS RunTime解析[1023:187762] property----&gt;property2</div><div class="line">2016-10-31 10:34:15.699257 iOS RunTime解析[1023:187762] property----&gt;property3</div><div class="line">2016-10-31 10:34:15.699305 iOS RunTime解析[1023:187762] property----&gt;property4</div><div class="line">2016-10-31 10:34:15.699369 iOS RunTime解析[1023:187762] property----&gt;hash</div><div class="line">2016-10-31 10:34:15.699470 iOS RunTime解析[1023:187762] property----&gt;superclass</div><div class="line">2016-10-31 10:34:15.699520 iOS RunTime解析[1023:187762] property----&gt;description</div><div class="line">2016-10-31 10:34:15.699804 iOS RunTime解析[1023:187762] property----&gt;debugDescription</div><div class="line">2016-10-31 10:34:15.699872 iOS RunTime解析[1023:187762] ----------获取方法---------</div><div class="line">2016-10-31 10:34:15.699970 iOS RunTime解析[1023:187762] method----&gt;getProperties</div><div class="line">2016-10-31 10:34:15.700054 iOS RunTime解析[1023:187762] method----&gt;testGetMethods</div><div class="line">2016-10-31 10:34:15.700124 iOS RunTime解析[1023:187762] method----&gt;property1</div><div class="line">2016-10-31 10:34:15.700188 iOS RunTime解析[1023:187762] method----&gt;setProperty1:</div><div class="line">2016-10-31 10:34:15.700249 iOS RunTime解析[1023:187762] method----&gt;property2</div><div class="line">2016-10-31 10:34:15.700399 iOS RunTime解析[1023:187762] method----&gt;setProperty2:</div><div class="line">2016-10-31 10:34:15.700485 iOS RunTime解析[1023:187762] method----&gt;property3</div><div class="line">2016-10-31 10:34:15.700596 iOS RunTime解析[1023:187762] method----&gt;setProperty3:</div><div class="line">2016-10-31 10:34:15.700666 iOS RunTime解析[1023:187762] method----&gt;property4</div><div class="line">2016-10-31 10:34:15.700789 iOS RunTime解析[1023:187762] method----&gt;setProperty4:</div><div class="line">2016-10-31 10:34:15.700885 iOS RunTime解析[1023:187762] method----&gt;property5</div><div class="line">2016-10-31 10:34:15.700937 iOS RunTime解析[1023:187762] method----&gt;setProperty5:</div><div class="line">2016-10-31 10:34:15.700988 iOS RunTime解析[1023:187762] method----&gt;property6</div><div class="line">2016-10-31 10:34:15.701036 iOS RunTime解析[1023:187762] method----&gt;setProperty6:</div><div class="line">2016-10-31 10:34:15.701083 iOS RunTime解析[1023:187762] method----&gt;property7</div><div class="line">2016-10-31 10:34:15.701132 iOS RunTime解析[1023:187762] method----&gt;setProperty7:</div><div class="line">2016-10-31 10:34:15.701244 iOS RunTime解析[1023:187762] method----&gt;property8</div><div class="line">2016-10-31 10:34:15.701309 iOS RunTime解析[1023:187762] method----&gt;setProperty8:</div><div class="line">2016-10-31 10:34:15.701440 iOS RunTime解析[1023:187762] method----&gt;.cxx_destruct</div><div class="line">2016-10-31 10:34:15.701518 iOS RunTime解析[1023:187762] method----&gt;didReceiveMemoryWarning</div><div class="line">2016-10-31 10:34:15.701621 iOS RunTime解析[1023:187762] method----&gt;viewDidLoad</div><div class="line">2016-10-31 10:34:15.701671 iOS RunTime解析[1023:187762] ----------获取成员变量---------</div><div class="line">2016-10-31 10:34:15.701746 iOS RunTime解析[1023:187762] Ivar----&gt;countTest</div><div class="line">2016-10-31 10:34:15.701795 iOS RunTime解析[1023:187762] Ivar----&gt;_property1</div><div class="line">2016-10-31 10:34:15.701865 iOS RunTime解析[1023:187762] Ivar----&gt;_property2</div><div class="line">2016-10-31 10:34:15.701916 iOS RunTime解析[1023:187762] Ivar----&gt;_property3</div><div class="line">2016-10-31 10:34:15.701964 iOS RunTime解析[1023:187762] Ivar----&gt;_property4</div><div class="line">2016-10-31 10:34:15.702012 iOS RunTime解析[1023:187762] Ivar----&gt;_property5</div><div class="line">2016-10-31 10:34:15.702059 iOS RunTime解析[1023:187762] Ivar----&gt;_property6</div><div class="line">2016-10-31 10:34:15.702106 iOS RunTime解析[1023:187762] Ivar----&gt;_property7</div><div class="line">2016-10-31 10:34:15.702154 iOS RunTime解析[1023:187762] Ivar----&gt;_property8</div><div class="line">2016-10-31 10:34:15.702192 iOS RunTime解析[1023:187762] ----------获取协议---------</div><div class="line">2016-10-31 10:34:15.702850 iOS RunTime解析[1023:187762] protocol----&gt;UINavigationBarDelegate</div><div class="line">2016-10-31 10:34:15.702908 iOS RunTime解析[1023:187762] protocol----&gt;UITabBarDelegate</div></pre></td></tr></table></figure>
<p>我们可以看到 无论是.h中申明 还是.m中的申明  全部打印了出来</p>
<p>而且还有一个规律  就是.m中的属性和方法 总是被首先打印出来</p>
<h3 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h3><p>我们看一下方法调用在运行时的过程</p>
<p>如果用实例对象调用实例方法，会到实例的isa指针指向的对象（也就是类对象）操作。</p>
<p>如果调用的是类方法，就会到类对象的isa指针指向的对象（也就是元类对象）中操作。</p>
<ul>
<li>首先，在相应操作的对象中的缓存方法列表中找调用的方法，如果找到，转向相应实现并执行。</li>
<li>如果没找到，在相应操作的对象中的方法列表中找调用的方法，如果找到，转向相应实现执行</li>
<li>如果没找到，去父类指针所指向的对象中执行1，2.</li>
<li>以此类推，如果一直到根类还没找到，转向拦截调用。</li>
<li>如果没有重写拦截调用的方法，程序报错。</li>
</ul>
<p>那么  这样 我们是不是可以这样做呢？</p>
<ul>
<li>重写父类的方法，并没有覆盖掉父类的方法，只是在当前类对象中找到了这个方法后就不会再去父类中找了。</li>
<li>如果想调用已经重写过的方法的父类的实现，只需使用super这个编译器标识，它会在运行时跳过在当前的类对象中寻找方法的过程。</li>
</ul>
<h3 id="拦截调用"><a href="#拦截调用" class="headerlink" title="拦截调用"></a>拦截调用</h3><p>在方法调用中说到了，如果没有找到方法就会转向拦截调用。</p>
<p>那么什么是拦截调用呢。</p>
<p>拦截调用就是，在找不到调用的方法程序崩溃之前，你有机会通过重写NSObject的四个方法来处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)resolveClassMethod:(SEL)sel;</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel;</div><div class="line">//后两个方法需要转发到其他的类处理</div><div class="line">- (id)forwardingTargetForSelector:(SEL)aSelector;</div><div class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation;</div></pre></td></tr></table></figure>
<ul>
<li>第一个方法是当你调用一个不存在的类方法的时候，会调用这个方法，默认返回NO，你可以加上自己的处理然后返回YES。</li>
<li>第二个方法和第一个方法相似，只不过处理的是实例方法。</li>
<li>第三个方法是将你调用的不存在的方法重定向到一个其他声明了这个方法的类，只需要你返回一个有这个方法的target。</li>
<li>第四个方法是将你调用的不存在的方法打包成NSInvocation传给你。做完你自己的处理后，调用invokeWithTarget:方法让某个target触发这个方法。</li>
</ul>
<h3 id="动态添加方法"><a href="#动态添加方法" class="headerlink" title="动态添加方法"></a>动态添加方法</h3><p>重写了拦截调用的方法并且返回了YES，我们要怎么处理呢？<br>有一个办法是根据传进来的SEL类型的selector动态添加一个方法。</p>
<p>首先从外部隐式调用一个不存在的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//隐式调用方法</div><div class="line">[target performSelector:@selector(resolveAdd:) withObject:@&quot;test&quot;];</div></pre></td></tr></table></figure>
<p>然后，在target对象内部重写拦截调用的方法，动态添加方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">void runAddMethod(id self, SEL _cmd, NSString *string)&#123;</div><div class="line">    NSLog(@&quot;add C IMP &quot;, string);</div><div class="line">&#125;</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel&#123;</div><div class="line"></div><div class="line">    //给本类动态添加一个方法</div><div class="line">    if ([NSStringFromSelector(sel) isEqualToString:@&quot;resolveAdd:&quot;]) &#123;</div><div class="line">        class_addMethod(self, sel, (IMP)runAddMethod, &quot;v@:*&quot;);</div><div class="line">    &#125;</div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中class_addMethod的四个参数分别是：</p>
<ul>
<li>Class cls 给哪个类添加方法，本例中是self</li>
<li>SEL name 添加的方法，本例中是重写的拦截调用传进来的selector。</li>
<li>IMP imp 方法的实现，C方法的方法实现可以直接获得。如果是OC方法，可以用+ (IMP)instanceMethodForSelector:(SEL)aSelector;获得方法的实现。</li>
<li>“v@:*”方法的签名，代表有一个参数的方法。</li>
</ul>
<h3 id="关联对象"><a href="#关联对象" class="headerlink" title="关联对象"></a>关联对象</h3><p>现在你准备用一个系统的类，但是系统的类并不能满足你的需求，你需要额外添加一个属性。<br>这种情况的一般解决办法就是继承。</p>
<p>但是，只增加一个属性，就去继承一个类，总是觉得太麻烦类。</p>
<p>这个时候，runtime的关联属性就发挥它的作用了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//首先定义一个全局变量，用它的地址作为关联对象的key</div><div class="line">static char associatedObjectKey;</div><div class="line">//设置关联对象</div><div class="line">objc_setAssociatedObject(target, &amp;associatedObjectKey, @&quot;添加的字符串属性&quot;, OBJC_ASSOCIATION_RETAIN_NONATOMIC); </div><div class="line">//获取关联对象</div><div class="line">NSString *string = objc_getAssociatedObject(target, &amp;associatedObjectKey);</div><div class="line">NSLog(@&quot;AssociatedObject = %@&quot;, string);</div></pre></td></tr></table></figure>
<p>objc_setAssociatedObject的四个参数：</p>
<ul>
<li>id object给谁设置关联对象。</li>
<li>const void *key关联对象唯一的key，获取时会用到。</li>
<li>id value关联对象。</li>
<li>objc_AssociationPolicy关联策略，有以下几种策略：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">enum&#123;</div><div class="line">	OBJC_ASSOCIATION_ASSIGN = 0,</div><div class="line">	OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, </div><div class="line">	OBJC_ASSOCIATION_COPY_NONATOMIC = 3,</div><div class="line">	OBJC_ASSOCIATION_RETAIN = 01401,</div><div class="line">	OBJC_ASSOCIATION_COPY = 01403 </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>objc_getAssociatedObject的两个参数:</p>
<ul>
<li>id object获取谁的关联对象。</li>
<li>const void *key根据这个唯一的key获取关联对象。</li>
</ul>
<p>其实，你还可以把添加和获取关联对象的方法写在你需要用到这个功能的类的类别中，方便使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//添加关联对象</div><div class="line">- (void)addAssociatedObject:(id)object&#123;</div><div class="line">    objc_setAssociatedObject(self, @selector(getAssociatedObject), object, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line">//获取关联对象</div><div class="line">- (id)getAssociatedObject&#123;</div><div class="line">    return objc_getAssociatedObject(self, _cmd);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>注意：</strong>这里面我们把getAssociatedObject方法的地址作为唯一的key，_cmd代表当前调用方法的地址。</p>
<h3 id="方法交换"><a href="#方法交换" class="headerlink" title="方法交换"></a>方法交换</h3><p>就是将两个方法的实现交换。例如，将A方法和B方法交换，调用A方法的时候，就会执行B方法中的代码，反之亦然。</p>
<p>我们来试一下  定义一个UIViewController的category</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> load方法会在类第一次加载的时候被调用</div><div class="line"> 调用的时间比较靠前，适合在这个方法里做方法交换</div><div class="line"> */</div><div class="line">+(void)load&#123;</div><div class="line">    //方法交换应该被保证，在程序中只会执行一次</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        //获得viewController的生命周期方法的selector</div><div class="line">        SEL systemSel = @selector(viewWillAppear:);</div><div class="line">        //自己实现的将要被交换的方法的selector</div><div class="line">        SEL customeSel = @selector(custome_viewWillAppear:);</div><div class="line">        //两个方法的Method</div><div class="line">        Method systemMethod = class_getInstanceMethod([self class], systemSel);</div><div class="line">        Method customeMethod = class_getInstanceMethod([self class], customeSel);</div><div class="line">        </div><div class="line">        //首先动态添加方法，实现是被交换的方法，返回值表示添加成功还是失败</div><div class="line">        BOOL isAdd = class_addMethod(self, systemSel, method_getImplementation(customeMethod), method_getTypeEncoding(customeMethod));</div><div class="line">        if (isAdd) &#123;</div><div class="line">            //如果成功，说明类中不存在这个方法的实现</div><div class="line">            //将被交换方法的实现替换到这个并不存在的实现</div><div class="line">            class_replaceMethod(self, customeSel, method_getImplementation(systemMethod), method_getTypeEncoding(systemMethod));</div><div class="line">        &#125;else&#123;</div><div class="line">            //否则，交换两个方法的实现</div><div class="line">            method_exchangeImplementations(systemMethod, customeMethod);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)custome_viewWillAppear:(BOOL)animated&#123;</div><div class="line">    //这时候调用自己，看起来像是死循环</div><div class="line">    //但是其实自己的实现已经被替换了</div><div class="line">    [self custome_viewWillAppear:animated];//这里 是去执行系统的viewWillApper:方法</div><div class="line">    NSLog(@&quot;custome&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在其他的controller中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">#import &quot;UIViewController+Custome.h&quot;</div><div class="line"></div><div class="line">@interface ViewController : UIViewController&lt;UITabBarDelegate&gt;</div><div class="line"></div><div class="line">@property (nonatomic, copy) NSString *property1;</div><div class="line">@property (nonatomic, copy) NSString *property2;</div><div class="line">@property (nonatomic, copy) NSString *property3;</div><div class="line">@property (nonatomic, copy) NSString *property4;</div><div class="line"></div><div class="line">- (void)testGetMethods;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>在.m中我们重写vieWillApper:方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-(void)viewWillAppear:(BOOL)animated&#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们将会看到在控制台 直接打印出了custome  </p>
<p>其实vieWillApper：方法已经被我们替换成我们自己的custome_viewWillAppear：</p>
<p>然后在我们自定义的custome_viewWillAppear:方法中  又调用了custome_viewWillAppear：本身  其实他已经被替换成viewWillApper：方法  所以这样就实现了 方法交换</p>
<p>写的有点多了  </p>
<p>演示代码  我放在了</p>
<p><a href="https://github.com/yangqian111/blog/tree/master/iOS%20RunTime解析" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/iOS%20RunTime解析</a></p>
<p>大功告成</p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/28/iOS一些基础Tips/" itemprop="url">
                  iOS一些基础Tips
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-28T15:24:51+08:00" content="2016-10-28">
              2016-10-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS基础/" itemprop="url" rel="index">
                    <span itemprop="name">iOS基础</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/28/iOS一些基础Tips/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/28/iOS一些基础Tips/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/28/iOS一些基础Tips/" class="leancloud_visitors" data-flag-title="iOS一些基础Tips">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>这里主要讲一些我在日常开发中用到的一些小的技巧，其实也算不上技巧吧，就是省去一些不必要的代码</strong></p>
<p><strong>本篇文章会持续更新，遇到的一些小东西都会记录下来</strong></p>
<h3 id="tip1-在UIView的扩展-快速修改frame"><a href="#tip1-在UIView的扩展-快速修改frame" class="headerlink" title="tip1:在UIView的扩展 快速修改frame"></a>tip1:在UIView的扩展 快速修改frame</h3><p>在iOS修改view的frame，我们经常需要写一大堆代码，来修改frame中的一个小属性，这里有一个方法，就是直接修改frame的每个值</p>
<p>新建一个category UIView+PPSFrame.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface UIView (PPSFrame)</div><div class="line"></div><div class="line">@property (assign, nonatomic) CGFloat    top;//上 相当于frame.origin.y</div><div class="line">@property (assign, nonatomic) CGFloat    bottom;//下 相当于frame.size.height + frame.origin.y</div><div class="line">@property (assign, nonatomic) CGFloat    left;//相当于frame.origin.x</div><div class="line">@property (assign, nonatomic) CGFloat    right;//相当于frame.origin.x+frame.size.width</div><div class="line"></div><div class="line">@property (assign, nonatomic) CGFloat    centerX;</div><div class="line">@property (assign, nonatomic) CGFloat    centerY;</div><div class="line"></div><div class="line">@property (assign, nonatomic) CGFloat    width;</div><div class="line">@property (assign, nonatomic) CGFloat    height;</div><div class="line">@property (assign, nonatomic) CGSize    size;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>在.m文件中设置各个属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line">#import &quot;UIView+Layout.h&quot;</div><div class="line"></div><div class="line">@implementation UIView (Layout)</div><div class="line"></div><div class="line">@dynamic top;</div><div class="line">@dynamic bottom;</div><div class="line">@dynamic left;</div><div class="line">@dynamic right;</div><div class="line"></div><div class="line">@dynamic width;</div><div class="line">@dynamic height;</div><div class="line"></div><div class="line">@dynamic size;</div><div class="line"></div><div class="line">- (CGFloat)top</div><div class="line">&#123;</div><div class="line">    return self.frame.origin.y;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setTop:(CGFloat)top</div><div class="line">&#123;</div><div class="line">    CGRect frame = self.frame;</div><div class="line">    frame.origin.y = top;</div><div class="line">    self.frame = frame;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)left</div><div class="line">&#123;</div><div class="line">    return self.frame.origin.x;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setLeft:(CGFloat)left</div><div class="line">&#123;</div><div class="line">    CGRect frame = self.frame;</div><div class="line">    frame.origin.x = left;</div><div class="line">    self.frame = frame;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)bottom</div><div class="line">&#123;</div><div class="line">    return self.frame.size.height + self.frame.origin.y;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setBottom:(CGFloat)bottom</div><div class="line">&#123;</div><div class="line">    CGRect frame = self.frame;</div><div class="line">    frame.origin.y = bottom - frame.size.height;</div><div class="line">    self.frame = frame;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)right</div><div class="line">&#123;</div><div class="line">    return self.frame.size.width + self.frame.origin.x;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setRight:(CGFloat)right</div><div class="line">&#123;</div><div class="line">    CGRect frame = self.frame;</div><div class="line">    frame.origin.x = right - frame.size.width;</div><div class="line">    self.frame = frame;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)centerX</div><div class="line">&#123;</div><div class="line">    return self.center.x;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setCenterX:(CGFloat)centerX</div><div class="line">&#123;</div><div class="line">    CGPoint center = self.center;</div><div class="line">    center.x = centerX;</div><div class="line">    self.center = center;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)centerY</div><div class="line">&#123;</div><div class="line">    return self.center.y;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setCenterY:(CGFloat)centerY</div><div class="line">&#123;</div><div class="line">    CGPoint center = self.center;</div><div class="line">    center.y = centerY;</div><div class="line">    self.center = center;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)width</div><div class="line">&#123;</div><div class="line">    return self.frame.size.width;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setWidth:(CGFloat)width</div><div class="line">&#123;</div><div class="line">    CGRect frame = self.frame;</div><div class="line">    frame.size.width = width;</div><div class="line">    self.frame = frame;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)height</div><div class="line">&#123;</div><div class="line">    return self.frame.size.height;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setHeight:(CGFloat)height</div><div class="line">&#123;</div><div class="line">    CGRect frame = self.frame;</div><div class="line">    frame.size.height = height;</div><div class="line">    self.frame = frame;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGSize)size</div><div class="line">&#123;</div><div class="line">    return self.frame.size;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setSize:(CGSize)size</div><div class="line">&#123;</div><div class="line">    CGRect frame = self.frame;</div><div class="line">    frame.size = size;</div><div class="line">    self.frame = frame;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>在改变view的frame的时候  只需要 view.top = 10 这样设置即可</p>
<h3 id="tips2-iOS-OC项目的pch文件使用"><a href="#tips2-iOS-OC项目的pch文件使用" class="headerlink" title="tips2 iOS OC项目的pch文件使用"></a>tips2 iOS OC项目的pch文件使用</h3><p>在项目中如果我们需要一些公共的引用，或者一些全局的宏  那我们经常在pch中设置好</p>
<p>具体怎么设置呢 在项目下新建一个pch文件 </p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161028_3.png" alt="1"></p>
<p>一般我会取名 项目名-PrefixHeader</p>
<p>在target——&gt;Bulid Setting 中 设置 PrefixHeader<br><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161028_6.png" alt="2"></p>
<p>我的项目文件夹结构</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161028_5.png" alt=""></p>
<p>$(SRCROOT)这个是指工程的根目录</p>
<p>找到这个pch文件就行  然后启动APP就会编译这个文件了</p>
<p>pch.h中 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//</div><div class="line">//  APP-1-PrefixHeader.pch</div><div class="line">//  APP-1</div><div class="line">//</div><div class="line">//  Created by 羊谦 on 2016/10/28.</div><div class="line">//  Copyright © 2016年 羊谦. All rights reserved.</div><div class="line">//</div><div class="line"></div><div class="line">#ifndef APP_1_PrefixHeader_pch</div><div class="line">#define APP_1_PrefixHeader_pch</div><div class="line"></div><div class="line">//在这里直接定义你的宏变量   或者公共引用就行</div><div class="line"></div><div class="line">#endif /* APP_1_PrefixHeader_pch */</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/27/iOS应用之间的跳转解析/" itemprop="url">
                  iOS应用之间的跳转解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-27T18:52:15+08:00" content="2016-10-27">
              2016-10-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS进阶/" itemprop="url" rel="index">
                    <span itemprop="name">iOS进阶</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/27/iOS应用之间的跳转解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/27/iOS应用之间的跳转解析/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/27/iOS应用之间的跳转解析/" class="leancloud_visitors" data-flag-title="iOS应用之间的跳转解析">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们先来看一下效果图</p>
<h3 id="这是从一个APP直接跳到另外一个APP的效果"><a href="#这是从一个APP直接跳到另外一个APP的效果" class="headerlink" title="这是从一个APP直接跳到另外一个APP的效果"></a>这是从一个APP直接跳到另外一个APP的效果</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/jump1.gif" alt="1"></p>
<h3 id="这是从一个APP跳到另一个APP的指定页面"><a href="#这是从一个APP跳到另一个APP的指定页面" class="headerlink" title="这是从一个APP跳到另一个APP的指定页面"></a>这是从一个APP跳到另一个APP的指定页面</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/jump2.gif" alt=""></p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><blockquote>
<p>在开发之中我们经常遇到需要从我们当前程序跳入到另外一个程序中，下面我们来说明一下这实现的过程</p>
</blockquote>
<h3 id="常见的跳转场景"><a href="#常见的跳转场景" class="headerlink" title="常见的跳转场景"></a>常见的跳转场景</h3><ul>
<li>使用第三方登录时，需要跳转社交APP，比如常见的QQ、微信、淘宝、支付宝等</li>
<li>分享我们的消息到其他APP，最常见的就是分享到QQ和微信，推广我们的APP</li>
<li>第三方支付，微信和支付宝</li>
<li>导航，跳转到地图类应用</li>
<li>跳转到系统的APP，打电话，发短信，发邮件等</li>
</ul>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>我们想要打开iOS中的一个应用，只需要拿到这个应用的协议头，我们就可以实现从一个APP跳到另外一个APP</p>
<blockquote>
<p>假设我们现在有两个APP，APP-1和APP-2，需要从APP-1跳到APP-2<br>那么我们就需要给APP-2绑定一个URL Schemes(自定义的应用协议头)，在APP-1中我们就可以实现用这个协议头跳到APP-2</p>
</blockquote>
<h3 id="一个APP直接跳到另外一个APP实现"><a href="#一个APP直接跳到另外一个APP实现" class="headerlink" title="一个APP直接跳到另外一个APP实现"></a>一个APP直接跳到另外一个APP实现</h3><p>创建两个项目APP-1和APP-2</p>
<p>在APP-2中，我们来绑定URL Schemes</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161028_1.png" alt="3"></p>
<p>在APP2的target中绑定协议头为 <strong>APP2</strong></p>
<p>然后我们在APP-1中添加一个按钮 来实现，点击跳转</p>
<p><strong><em>注意，这两个APP得在手机上都安装上，才能跳转</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[btn1 addTarget:self action:@selector(jumpToApp2) forControlEvents:UIControlEventTouchUpInside];</div></pre></td></tr></table></figure>
<p>跳转方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (void)jumpToApp2&#123;</div><div class="line">    //获取APP2的URL Scheme</div><div class="line">    NSURL *appURL = [NSURL URLWithString:@&quot;APP2://&quot;];</div><div class="line">    </div><div class="line">    //判断手机中是否安装了APP2</div><div class="line">    if ([[UIApplication sharedApplication] canOpenURL:appURL]) &#123;</div><div class="line">        //打开APP2</div><div class="line">        [[UIApplication sharedApplication] openURL:appURL];</div><div class="line">    &#125;else&#123;</div><div class="line">        NSLog(@&quot;没有安装APP2&quot;);</div><div class="line">    &#125;</div><div class="line">    // ---------------如果是iOS9之前，上面代码就可以实现跳转了---------------------</div><div class="line">    // ---------------iOS9之后需要在应用程序中加上白名单，即在APP-1中加上APP-2的白名单---------</div><div class="line">    // ----------------在APP-1的Info中 添加键值对LSApplicationQueriesSchemes---------------------------------</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在iOS9之后，跳转 我们需要在APP中设置需要跳转的URL Schemes才能实现跳转  即在Info中添加LSApplicationQueriesSchemes键值对</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161028_2.png" alt="5"></p>
<p>然后我们就可以实现跳转了</p>
<p>看一下效果</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/jump1.gif" alt="1"></p>
<h3 id="一个APP跳到另一个APP的指定页面"><a href="#一个APP跳到另一个APP的指定页面" class="headerlink" title="一个APP跳到另一个APP的指定页面"></a>一个APP跳到另一个APP的指定页面</h3><p>这个实现起来也很简单的，首先在APP2中新建两个ViewController</p>
<p>然后在APP-1中添加两个按钮分别是跳转到不同的页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">UIButton *btn1 = [[UIButton alloc] initWithFrame:CGRectMake(50, 150, 200, 30)];</div><div class="line">[btn1 setTitle:@&quot;跳转到第一个界面&quot; forState:UIControlStateNormal];</div><div class="line">[btn1 addTarget:self action:@selector(jumpToApp2_1) forControlEvents:UIControlEventTouchUpInside];</div><div class="line">btn1.backgroundColor = [UIColor redColor];</div><div class="line">[self.view addSubview:btn1];</div><div class="line">    </div><div class="line">UIButton *btn2 = [[UIButton alloc] initWithFrame:CGRectMake(50, 200, 200, 30)];</div><div class="line">[btn2 setTitle:@&quot;跳转到第二个界面&quot; forState:UIControlStateNormal];</div><div class="line">[btn2 addTarget:self action:@selector(jumpToApp2_2) forControlEvents:UIControlEventTouchUpInside];</div><div class="line">btn2.backgroundColor = [UIColor redColor];</div></pre></td></tr></table></figure>
<p>跳转方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (void)jumpToApp2_1&#123;</div><div class="line">    //获取APP2的URL Scheme</div><div class="line">    NSURL *appURL = [NSURL URLWithString:@&quot;APP2://VC1&quot;];</div><div class="line">    </div><div class="line">    //判断手机中是否安装了APP2</div><div class="line">    if ([[UIApplication sharedApplication] canOpenURL:appURL]) &#123;</div><div class="line">        //打开APP2的ViewController1</div><div class="line">        [[UIApplication sharedApplication] openURL:appURL];</div><div class="line">    &#125;else&#123;</div><div class="line">        NSLog(@&quot;没有安装APP2&quot;);</div><div class="line">    &#125;</div><div class="line">// ---------------如果是iOS9之前，上面代码就可以实现跳转了---------------------</div><div class="line">// ---------------iOS9之后需要在应用程序中加上白名单，即在APP-1中加上APP-2的白名单---------</div><div class="line">// ----------------在APP-1的Info中 添加键值对LSApplicationQueriesSchemes---------------------------------</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)jumpToApp2_2&#123;</div><div class="line">    //获取APP2的URL Scheme</div><div class="line">    NSURL *appURL = [NSURL URLWithString:@&quot;APP2://VC2&quot;];</div><div class="line">    </div><div class="line">    //判断手机中是否安装了APP2</div><div class="line">    if ([[UIApplication sharedApplication] canOpenURL:appURL]) &#123;</div><div class="line">        //打开APP2ViewController2</div><div class="line">        [[UIApplication sharedApplication] openURL:appURL];</div><div class="line">    &#125;else&#123;</div><div class="line">        NSLog(@&quot;没有安装APP2&quot;);</div><div class="line">    &#125;</div><div class="line">    // ---------------如果是iOS9之前，上面代码就可以实现跳转了---------------------</div><div class="line">    // ---------------iOS9之后需要在应用程序中加上白名单，即在APP-1中加上APP-2的白名单---------</div><div class="line">    // ----------------在APP-1的Info中 添加键值对LSApplicationQueriesSchemes---------------------------------</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过对跳转的协议头添加不同的描述，来实现不同的跳转</p>
<p>然后我们在APP-2的delegate中 实现方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// 因为现在xcode8 最低支持8.0 所以  我还是用这个方法吧</div><div class="line">-(BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation&#123;</div><div class="line">    </div><div class="line">    //获取根控制器</div><div class="line">    UINavigationController *nvc = (UINavigationController *)self.window.rootViewController;</div><div class="line">//    ViewController *vc = nvc.childViewControllers.firstObject;</div><div class="line">    </div><div class="line">    //每次跳转都必须要在根控制器 这一点比较重要</div><div class="line">    [nvc popToRootViewControllerAnimated:YES];</div><div class="line">    </div><div class="line">    //根据url判断需要展示的VC</div><div class="line">    if ([url.absoluteString containsString:@&quot;VC1&quot;]) &#123;</div><div class="line">        ViewController1 *vc1 = [[ViewController1 alloc] init];</div><div class="line">//        [vc presentViewController:vc1 animated:YES completion:nil];</div><div class="line">        [nvc pushViewController:vc1 animated:YES];</div><div class="line">    &#125;else if([url.absoluteString containsString:@&quot;VC2&quot;])&#123;</div><div class="line">        ViewController2 *vc2 = [[ViewController2 alloc] init];</div><div class="line">        [nvc pushViewController:vc2 animated:YES];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实现跳转监听，这样就能跳转到不同的页面了</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/jump2.gif" alt=""></p>
<p>源代码放在了</p>
<p><a href="https://github.com/yangqian111/blog/tree/master/APP-1" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/APP-1</a></p>
<p><a href="https://github.com/yangqian111/blog/tree/master/APP-2" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/APP-2</a></p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/26/iOS网络监测区分2、3、4G/" itemprop="url">
                  iOS网络监测区分2、3、4G
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-26T19:07:14+08:00" content="2016-10-26">
              2016-10-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS基础-网络组件/" itemprop="url" rel="index">
                    <span itemprop="name">iOS基础 网络组件</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/26/iOS网络监测区分2、3、4G/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/26/iOS网络监测区分2、3、4G/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/26/iOS网络监测区分2、3、4G/" class="leancloud_visitors" data-flag-title="iOS网络监测区分2、3、4G">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如果有在使用AFNetworking朋友知道，在AF里只能区分当前网络是WiFi网络还是蜂窝网络在3G、4G出现以后，我们就有一个新需求，需要区分2G、3G、4G网络了，虽然同为蜂窝网络但是速度可是千差万别，有时我们会感觉到4G比WiFi还快，当然流量也是跑的相当肉痛</p>
<p>下面我们就来讲一讲怎么区分2G 3G 4G网络  </p>
<h3 id="下载Reachability"><a href="#下载Reachability" class="headerlink" title="下载Reachability"></a>下载Reachability</h3><p>首先我们需要下载苹果官方的一个示例工程 </p>
<p><a href="https://developer.apple.com/library/content/samplecode/Reachability/Introduction/Intro.html" target="_blank" rel="external">https://developer.apple.com/library/content/samplecode/Reachability/Introduction/Intro.html</a></p>
<p>在这个工程里有我们需要用到的 苹果官方提供的实时监测网络的类 我们是在这个基础上 稍作修改就可以做到</p>
<p>进入网页 </p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161026_1.png" alt="1"></p>
<p>在示例代码中 将Reachability类拷贝到我们的项目当中</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161026_2.png" alt="2"></p>
<h3 id="修改Reachability"><a href="#修改Reachability" class="headerlink" title="修改Reachability"></a>修改Reachability</h3><p>首先修改Reachability类中的网络类型枚举:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef enum : NSInteger &#123;</div><div class="line">	NotReachable = 0,</div><div class="line">	ReachableViaWiFi,</div><div class="line">	ReachableViaWWAN,</div><div class="line">    kReachableVia2G,</div><div class="line">    kReachableVia3G,</div><div class="line">    kReachableVia4G</div><div class="line">&#125; NetworkStatus;</div></pre></td></tr></table></figure>
<p>然后再.m文件中 找到方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (NetworkStatus)networkStatusForFlags:(SCNetworkReachabilityFlags)flags;</div></pre></td></tr></table></figure>
<p>增加判断2G 3G 4G的方法<br>在 if ((flags &amp; kSCNetworkReachabilityFlagsIsWWAN) == kSCNetworkReachabilityFlagsIsWWAN) 判断中加上代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">if ((flags &amp; kSCNetworkReachabilityFlagsIsWWAN) == kSCNetworkReachabilityFlagsIsWWAN)</div><div class="line">	&#123;</div><div class="line">        returnValue = ReachableViaWWAN;</div><div class="line">        </div><div class="line">        CTTelephonyNetworkInfo *phonyNetwork = [[CTTelephonyNetworkInfo alloc] init];</div><div class="line">        NSString *currentStr = phonyNetwork.currentRadioAccessTechnology;</div><div class="line">        if (currentStr) &#123;</div><div class="line">            if ([currentStr isEqualToString:CTRadioAccessTechnologyLTE]) &#123;</div><div class="line">                return kReachableVia4G;</div><div class="line">            &#125;else if ([currentStr isEqualToString:CTRadioAccessTechnologyGPRS]|| [currentStr isEqualToString:CTRadioAccessTechnologyEdge])&#123;</div><div class="line">                return kReachableVia2G;</div><div class="line">            &#125;else&#123;</div><div class="line">                return kReachableVia3G;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if ((flags &amp; kSCNetworkReachabilityFlagsTransientConnection) == kSCNetworkReachabilityFlagsTransientConnection) &#123;</div><div class="line">            if((flags &amp; kSCNetworkReachabilityFlagsConnectionRequired) == kSCNetworkReachabilityFlagsConnectionRequired) &#123;</div><div class="line">                return kReachableVia2G;</div><div class="line">            &#125;</div><div class="line">            return kReachableVia3G;</div><div class="line">        &#125;</div><div class="line">        return ReachableViaWWAN;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>在需要用到的地方引入我们修改过后的Reachability</p>
<h3 id="使用Reachability"><a href="#使用Reachability" class="headerlink" title="使用Reachability"></a>使用Reachability</h3><p>监听网络变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">//添加网络监测</div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self</div><div class="line">                                             selector:@selector(reachabilityChanged:)</div><div class="line">                                                 name: kReachabilityChangedNotification</div><div class="line">                                               object: nil];</div><div class="line">    </div><div class="line">    //开启网络监测</div><div class="line">    self.intertReach = [Reachability reachabilityForInternetConnection];</div><div class="line">    [self.intertReach startNotifier];</div><div class="line">    </div><div class="line">    UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(100, 100, 300, 30)];</div><div class="line">    [self.view addSubview:label];</div><div class="line">    self.label = label;</div><div class="line">    </div><div class="line">    //获取当前的网络状态</div><div class="line">    NetworkStatus status = [self.intertReach currentReachabilityStatus];</div><div class="line">    [self judgeNetWorkStatus:status];</div></pre></td></tr></table></figure>
<p>当网络发生改变时 会触发</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 当网络状态发生变换时 会触发这个方法</div><div class="line"></div><div class="line"> @param no 通知</div><div class="line"> */</div><div class="line">- (void)reachabilityChanged:(NSNotification *)no&#123;</div><div class="line">    Reachability* curReach = [no object];</div><div class="line">    NSParameterAssert([curReach isKindOfClass: [Reachability class]]);</div><div class="line">    NetworkStatus status = [curReach currentReachabilityStatus];</div><div class="line">    [self judgeNetWorkStatus:status];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>还是很简单的 </p>
<p>源代码 放在了</p>
<p><a href="https://github.com/yangqian111/blog/tree/master/iOS网络区分2、3、4G" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/iOS网络区分2、3、4G</a></p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/25/Mac使用gitbook创建电子书/" itemprop="url">
                  Mac使用gitbook创建电子书
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-25T13:46:27+08:00" content="2016-10-25">
              2016-10-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Mac工具/" itemprop="url" rel="index">
                    <span itemprop="name">Mac工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/25/Mac使用gitbook创建电子书/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/25/Mac使用gitbook创建电子书/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/25/Mac使用gitbook创建电子书/" class="leancloud_visitors" data-flag-title="Mac使用gitbook创建电子书">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>gitbook是开源书籍的平台，公司目前的一些开发文档，还有使用文档都是使用gitbook管理，用起来很方便，所以这里分享一下创建方法</p>
<h2 id="安装gitbook"><a href="#安装gitbook" class="headerlink" title="安装gitbook"></a>安装gitbook</h2><h3 id="安装npm"><a href="#安装npm" class="headerlink" title="安装npm"></a>安装npm</h3><p>从 <a href="https://nodejs.org/#download" target="_blank" rel="external">https://nodejs.org/#download</a> 下载 安装node.js</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_1.png" alt="nodejs"></p>
<p>安装成功之后 打开终端  输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm -v</div></pre></td></tr></table></figure>
<p>显示如下：</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_2.png" alt="1"></p>
<p>说明安装成功</p>
<h3 id="安装gitbook-1"><a href="#安装gitbook-1" class="headerlink" title="安装gitbook"></a>安装gitbook</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo npm install -g gitbook-cli</div></pre></td></tr></table></figure>
<p>安装成功之后  终端：</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_3.png" alt="2"></p>
<p>说明  gitbook安装成功</p>
<p>此时到 你想要放电子书的地方创建一个文件夹 </p>
<p>我就在我的用户目录下创建了 testBook</p>
<p>进入到 当前创建的testBook</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_7.png" alt="3"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch README.md</div></pre></td></tr></table></figure>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_8.png" alt="4"></p>
<p>README.md相当于是这本书籍的简介 </p>
<p>然后 继续</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch SUMMARY.md</div></pre></td></tr></table></figure>
<p>SUMMARY.md 这个是本书籍的目录 </p>
<p>接下来  我们去到创建的文件夹 testBook下查看</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_9.png" alt="5"></p>
<p>用markdown 工具打开  当然也可以使用文本编辑器(我使用的是MacDown)  语法是markdown语法</p>
<p>编辑 SUMMARY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">* [简介](README.md)</div><div class="line">* [第一章](chapter1/README.md)</div><div class="line"> - [第一节](chapter1/section1.md)</div><div class="line"> - [第二节](chapter1/section2.md)</div><div class="line">* [第二章](chapter2/README.md)</div><div class="line"> - [第一节](chapter2/section1.md)</div><div class="line"> - [第二节](chapter2/section2.md)</div><div class="line">* [结束](end/README.md)</div></pre></td></tr></table></figure>
<p>保存  </p>
<p>然后打开终端  进入当前目录  运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gitbook init</div></pre></td></tr></table></figure>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_11.png" alt="6"></p>
<p>再次查看  目录 就成了：</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_12.png" alt="7"></p>
<p>在终端 继续运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gitbook serve</div></pre></td></tr></table></figure>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_13.png" alt="7"></p>
<p>这时我们打开 浏览器输入 localhost:4000</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/Snip20161025_14.png" alt="8"></p>
<p>电子书就创建成功了</p>
<p>在testBook中的目录</p>
<p>chapter1  chapter2 对应的</p>
<p>分别是第一章 第二章 以此类推</p>
<p>写东西  都只需要在对应的.md文件中编写   遵循markdown语法就行</p>
<p>如果想要把自己写的东西分享出去  需要在gitbook中创建书籍  使用gitbook出品的工具gitbook editor </p>
<p><a href="https://www.gitbook.com/editor" target="_blank" rel="external">https://www.gitbook.com/editor</a></p>
<p>可以实现轻松发布  这个就不写出来了  因为我是发布到公司内部地址</p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/25/iOS推送详细分析/" itemprop="url">
                  iOS推送详细分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-25T10:52:19+08:00" content="2016-10-25">
              2016-10-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS基础/" itemprop="url" rel="index">
                    <span itemprop="name">iOS基础</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/25/iOS推送详细分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/25/iOS推送详细分析/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/25/iOS推送详细分析/" class="leancloud_visitors" data-flag-title="iOS推送详细分析">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/24/iOS类似于微信的ActionSheet/" itemprop="url">
                  iOS类似于微信的ActionSheet
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-24T13:47:13+08:00" content="2016-10-24">
              2016-10-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS小组件/" itemprop="url" rel="index">
                    <span itemprop="name">iOS小组件</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/24/iOS类似于微信的ActionSheet/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/24/iOS类似于微信的ActionSheet/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/24/iOS类似于微信的ActionSheet/" class="leancloud_visitors" data-flag-title="iOS类似于微信的ActionSheet">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前在做图片浏览器的时候 需要用到类似于微信的ActionSheet  本来可以直接使用iOS官方的UIAlertController 但是我觉得上了 iOS9 之后 这个ActionSheet好丑  不喜欢  就自己 写了一个简单的</p>
<p>先看一下效果图</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/actionsheet.gif" alt="ActionSheet"></p>
<p>实现起来 还是挺简单的</p>
<p>首先肯定是一个自定义的view，在这里  是使用delegate实现点击捕获的  个人感觉delegate使用起来比较简单  当然block使用起来也不是特别麻烦，这个就看个人爱好吧</p>
<p>在自定义view里面有一个协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@protocol PPSActionSheetDelegate &lt;NSObject&gt;</div><div class="line"></div><div class="line">@required //当然这个可以写成optional的，但是不捕获点击事件，又做actionsheet干啥呢  就干脆写成了必须实现的  这样在使用的时候 发现未实现方法</div><div class="line"></div><div class="line">/**</div><div class="line"> 点击选项 实现这个代理必须实现这个方法 不然点击不能实现</div><div class="line"></div><div class="line"> @param actionSheet 当前显示的actionsheet 如果存在多个actionsheet 可以分别出是哪一个actionsheet</div><div class="line"> @param buttonIndex 点击的位置</div><div class="line"> */</div><div class="line">- (void)actionSheet:(PPSActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<font color="red">在点击事件里面 回传actionsheet的目的  是因为在一个viewcontroller里面可能会有多个 actionsheet展现，在同一个VC里面就需要区分 是哪个actionsheet 来区分操作<br><br>不同的actionsheet当然可以使用tag来区分 当然也可以用其他的方法区分<br><br>这里就仁者见仁智者见智了</font>

<p>实现方法里面也没有什么可讲的  都是很简单的实现方法</p>
<p>根据传入的标题数目  来创建button选项</p>
<p>这一段代码  其实是对传入的othertitles的一个遍历 创建选项</p>
<p>va_list是C语言中 解决变参问题的一组宏 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">NSString* curStr;</div><div class="line">va_list list;</div><div class="line">   if(otherTitles)</div><div class="line">   &#123;</div><div class="line">       [self setupBtnWithTitle:otherTitles];</div><div class="line">       </div><div class="line">       va_start(list, otherTitles);</div><div class="line">       while ((curStr = va_arg(list, NSString*))) &#123;</div><div class="line">           [self setupBtnWithTitle:curStr];</div><div class="line">           </div><div class="line">       &#125;</div><div class="line">       va_end(list);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>根据颜生成图片的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 根据颜色生成图片</div><div class="line"></div><div class="line"> @param color 颜色</div><div class="line"></div><div class="line"> @return 图片</div><div class="line"> */</div><div class="line">- (UIImage*)imageWithColor:(UIColor*)color</div><div class="line">&#123;</div><div class="line">    CGRect rect=CGRectMake(0.0f, 0.0f, 1.0f, 1.0f);</div><div class="line">    UIGraphicsBeginImageContext(rect.size);</div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line">    CGContextSetFillColorWithColor(context, [color CGColor]);</div><div class="line">    CGContextFillRect(context, rect);</div><div class="line">    UIImage *theImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    return theImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>源码放在了：<br>    <a href="https://github.com/yangqian111/blog/tree/master/iOS类似微信的ActionSheet" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/iOS类似微信的ActionSheet</a></p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/20/iOS图片浏览器-二/" itemprop="url">
                  iOS图片浏览器-二
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-20T16:53:36+08:00" content="2016-10-20">
              2016-10-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS组件/" itemprop="url" rel="index">
                    <span itemprop="name">iOS组件</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/20/iOS图片浏览器-二/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/20/iOS图片浏览器-二/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/20/iOS图片浏览器-二/" class="leancloud_visitors" data-flag-title="iOS图片浏览器-二">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>上一篇文章讲到了图片的浏览  这里就把剩下的完善了吧<br>现在我们要加入的主要有以下几个点：</p>
<ul>
<li><strong>图片下载时的进度条</strong></li>
<li><strong>UIScrollView的滑动 查看多张图片</strong></li>
<li><strong>长按图片 弹出保存图片的选项</strong></li>
</ul>
<p>###效果<br>先看一下初步效果  还没做完 边写边做<br><img src="http://o8bxt3lx0.bkt.clouddn.com/savePhotoBrower.gif" alt="photoBrower"></p>
<h3 id="画进度圆"><a href="#画进度圆" class="headerlink" title="画进度圆"></a>画进度圆</h3><p>首先我们需要一个能显示进度的进度条 那就动手来写一个吧</p>
<p>先说一下思路 这个圆应该是根据不同的进度条 来绘制进度  所以需要及时传进进度 然后绘制图像 主要的代码 还是在drawRect这个方法里面  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (void)drawRect:(CGRect)rect</div><div class="line">&#123;</div><div class="line">    CGContextRef ctx = UIGraphicsGetCurrentContext();</div><div class="line">    </div><div class="line">    //在当前的view中心点画圆 画灰色的那个全圆</div><div class="line">    CGFloat xCenter = rect.size.width * 0.5;</div><div class="line">    CGFloat yCenter = rect.size.height * 0.5;</div><div class="line">    </div><div class="line">    //计算圆的半径</div><div class="line">    CGFloat radius = MIN(rect.size.width * 0.5, rect.size.height * 0.5) - YQProgressViewItemMargin;</div><div class="line">    </div><div class="line">    // 背景圆</div><div class="line">    [YQColorMaker(240, 240, 240, 1) set];</div><div class="line">    //set方法 苹果是这样给出说明的 大致意思就是在当前画的这个view的这个范围内	//	用什么颜色填充</div><div class="line">    // Set the color: Sets the fill and stroke colors in the current 	//	drawing context. Should be implemented by subclassers.</div><div class="line">	//	- (void)set;</div><div class="line">    </div><div class="line">    CGFloat w = radius * 2 + 4;</div><div class="line">    CGFloat h = w;</div><div class="line">    CGFloat x = (rect.size.width - w) * 0.5;</div><div class="line">    CGFloat y = (rect.size.height - h) * 0.5;</div><div class="line">    CGContextAddEllipseInRect(ctx, CGRectMake(x, y, w, h));</div><div class="line">    CGContextFillPath(ctx);</div><div class="line">    </div><div class="line">    // 进程圆 画白色的圆</div><div class="line">    [YQColorMaker(150, 150, 150, 0.8) set];</div><div class="line">    CGContextMoveToPoint(ctx, xCenter, yCenter);</div><div class="line">    CGContextAddLineToPoint(ctx, xCenter, 0);</div><div class="line">    CGFloat to = -M_PI * 0.5 + self.progress * M_PI * 2 + 0.001; // 初始值</div><div class="line">    CGContextAddArc(ctx, xCenter, yCenter, radius, -M_PI * 0.5, to, 1);</div><div class="line">    CGContextClosePath(ctx);</div><div class="line">    </div><div class="line">    CGContextFillPath(ctx);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="加入单个图片"><a href="#加入单个图片" class="headerlink" title="加入单个图片"></a>加入单个图片</h3><p>然后就是在我们之前的设置每张图片的位置  将这个下载进度的view添加进去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 创建每一张照片 每一张照片都是一个scrollview</div><div class="line"> scrollview可缩放</div><div class="line"> */</div><div class="line">-(void)setupphotoScrollViews&#123;</div><div class="line">    for (int i=0; i&lt;self.photos.count; i++) &#123;</div><div class="line">        UIScrollView *photoScrollView = [[UIScrollView alloc] init];</div><div class="line">        photoScrollView.backgroundColor = [UIColor clearColor];</div><div class="line">        photoScrollView.tag = i;</div><div class="line">        photoScrollView.frame = CGRectMake(SCREEN_WIDTH*i, 0, SCREEN_WIDTH, SCREEN_HEIGHT);</div><div class="line">        photoScrollView.delegate = self;</div><div class="line">        photoScrollView.maximumZoomScale=2.0;</div><div class="line">        photoScrollView.minimumZoomScale=1;</div><div class="line">        [self.outScrollView addSubview:photoScrollView];</div><div class="line">        </div><div class="line">        Photo *photo = self.photos[i];</div><div class="line">        UITapGestureRecognizer *photoTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(photoTap:)];</div><div class="line">        UITapGestureRecognizer *zonmTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(zonmTap:)];</div><div class="line">        zonmTap.numberOfTapsRequired = 2;</div><div class="line">        [photoScrollView addGestureRecognizer:photoTap];</div><div class="line">        [photoScrollView addGestureRecognizer:zonmTap];</div><div class="line">        [photoTap requireGestureRecognizerToFail:zonmTap];</div><div class="line">        </div><div class="line">        [photoScrollView addSubview:photo];</div><div class="line">        //有本地高清大图 直接大图显示出来就不需要再次访问网络</div><div class="line">        if (photo.fullImage) &#123;</div><div class="line">            photo.image = photo.fullImage;</div><div class="line">            photo.frame = [self.originRects[i] CGRectValue];</div><div class="line">            [UIView animateWithDuration:0.3 animations:^&#123;</div><div class="line">                </div><div class="line">                self.blackView.alpha = 1.0;</div><div class="line">                </div><div class="line">                CGFloat ratio = (double)photo.image.size.height/(double)photo.image.size.width;</div><div class="line">                </div><div class="line">                CGFloat bigW = SCREEN_WIDTH;</div><div class="line">                CGFloat bigH = SCREEN_WIDTH*ratio;</div><div class="line">                </div><div class="line">                photo.bounds = CGRectMake(0, 0, bigW, bigH);</div><div class="line">                photo.center = CGPointMake(SCREEN_WIDTH/2, SCREEN_HEIGHT/2);</div><div class="line">            &#125;];</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        ProgressView *progress = [[ProgressView alloc] initWithFrame:CGRectMake(SCREEN_WIDTH/2.0-30, SCREEN_HEIGHT/2.0-30, 60, 60)];</div><div class="line">        NSURL *fullImgUrl = [NSURL URLWithString:photo.fullImgUrl];</div><div class="line">        [photo sd_setImageWithURL:fullImgUrl placeholderImage:nil options:SDWebImageRetryFailed | SDWebImageLowPriority progress:^(NSInteger receivedSize, NSInteger expectedSize) &#123;</div><div class="line">            //开始下载  这里后面会做一些效果 比如下载的进度条  一个load</div><div class="line">            photo.frame = CGRectMake(0, 0, SCREEN_WIDTH/2, SCREEN_HEIGHT/3);</div><div class="line">            photo.center = CGPointMake(SCREEN_WIDTH/2, SCREEN_HEIGHT/2);</div><div class="line">            photo.image = photo.thumbnail.image;</div><div class="line">            self.blackView.alpha = 1.0;</div><div class="line">            [photoScrollView addSubview:progress];</div><div class="line">            progress.progress = receivedSize*1.0/expectedSize*1.0;</div><div class="line">            </div><div class="line">        &#125; completed:^(UIImage *image, NSError *error, SDImageCacheType cacheType, NSURL *imageURL) &#123;</div><div class="line">            if (image!=nil) &#123;</div><div class="line">                [progress dismiss];</div><div class="line">                photo.frame = [self.originRects[i] CGRectValue];</div><div class="line">                //如果是网上下载下来的图片  那么改变一下photo的位置  后面做动画 会和已有缓存的图片显示效果不一样</div><div class="line">                if (cacheType==SDImageCacheTypeNone) &#123;</div><div class="line">                    photo.frame = CGRectMake(0, 0, SCREEN_WIDTH/2, SCREEN_HEIGHT/2);</div><div class="line">                    photo.center = CGPointMake(SCREEN_WIDTH/2, SCREEN_HEIGHT/2);</div><div class="line">                &#125;</div><div class="line">                [UIView animateWithDuration:0.3 animations:^&#123;</div><div class="line">                    self.blackView.alpha = 1.0;</div><div class="line">                    CGFloat ratio = (double)photo.image.size.height/(double)photo.image.size.width;</div><div class="line">                    CGFloat bigW = SCREEN_WIDTH;</div><div class="line">                    CGFloat bigH = SCREEN_WIDTH*ratio;</div><div class="line">                    photo.bounds = CGRectMake(0, 0, bigW, bigH);</div><div class="line">                    photo.center = CGPointMake(SCREEN_WIDTH/2, SCREEN_HEIGHT/2);</div><div class="line">                &#125;];</div><div class="line">            &#125;else&#123;</div><div class="line">               //下载错误 提示一个 错误需要 这里可以根据你自己项目的需求 提示错误 alert  还是  一个类似于Android的toast都可以  我觉得alert还是 太不友好了</div><div class="line">            &#125;</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样  每张图片都有自己对应的下载进度  下载完成之后  会在complete方法之中 将progress移除掉</p>
<p>再加入uiscrollView的滑动切换图片</p>
<p>在之前我们就已经想到了 所以在写的时候 在show方法中 加入当前UIscrollView偏移量和contentsize</p>
<h3 id="设置外层的UIScrollView"><a href="#设置外层的UIScrollView" class="headerlink" title="设置外层的UIScrollView"></a>设置外层的UIScrollView</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//3.设置滚动距离</div><div class="line">    self.outScrollView.contentSize = CGSizeMake(SCREEN_WIDTH*self.photos.count, 0);</div><div class="line">    self.outScrollView.contentOffset = CGPointMake(SCREEN_WIDTH*self.currentIndex, 0);</div></pre></td></tr></table></figure>
<p>在展示的时候 只需要调用 photoBrower的show方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 显示大图</div><div class="line"></div><div class="line"> @param photos 照片数组 装的Photo</div><div class="line"> @param index  当前的照片是第几张</div><div class="line"> */</div><div class="line">+ (void)showWithPhotos:(NSArray *)photos index:(NSInteger)index;</div></pre></td></tr></table></figure>
<p>同样的测试一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">UIImageView *thumbnail = (UIImageView *)recognizer.view;</div><div class="line">    Photo *photo = nil;</div><div class="line">    Photo *photo1 = nil;</div><div class="line">    if (thumbnail.tag&lt;3) &#123;//属于有大图的</div><div class="line">        photo = [[Photo alloc] initWithThumbnail:thumbnail fullImage:thumbnail.image fullImgUrl:nil];</div><div class="line">        photo1 = [[Photo alloc] initWithThumbnail:thumbnail fullImage:thumbnail.image fullImgUrl:nil];</div><div class="line">    &#125;else&#123;</div><div class="line">        photo = [[Photo alloc] initWithThumbnail:thumbnail fullImage:nil fullImgUrl:@&quot;http://pic24.nipic.com/20121003/10754047_140022530392_2.jpg&quot;];</div><div class="line">        photo1 = [[Photo alloc] initWithThumbnail:thumbnail fullImage:nil fullImgUrl:@&quot;http://e.hiphotos.baidu.com/image/pic/item/14ce36d3d539b600be63e95eed50352ac75cb7ae.jpg&quot;];</div><div class="line">    &#125;</div><div class="line">   [PhotoBrower showWithPhotos:@[photo,photo1] index:0];</div></pre></td></tr></table></figure>
<p>在photo中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/**</div><div class="line"> *  缩略图 imageView</div><div class="line"> */</div><div class="line">@property (nonatomic, strong) UIImageView *thumbnail;</div><div class="line"></div><div class="line">/**</div><div class="line"> 高清图</div><div class="line"> 如果存在  则在显示的时候优先显示设置的本地大图</div><div class="line"> */</div><div class="line">@property (nonatomic, strong) UIImage *fullImage;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> *  大图URL   存在本地大图时  还是优先显示本地大图</div><div class="line"> */</div><div class="line">@property (nonatomic,strong) NSString *fullImgUrl;</div></pre></td></tr></table></figure>
<p>如果当前查看的图片没有本地图片  那么 只需要传入thumbnail fullImgUrl</p>
<p>如果当前的有本地图和远程图  那么三个都传入  会优先展示本地的图片</p>
<p>因为图片下载使用的SDWebImage  所以下载的图片也是优先使用 缓存</p>
<h3 id="保存图片到相册"><a href="#保存图片到相册" class="headerlink" title="保存图片到相册"></a>保存图片到相册</h3><p>再加上保存图片的方法 简单的图片浏览器就基本完成了</p>
<p>先看一下效果是怎样<br>允许你访问相册 保存成功<br><img src="http://o8bxt3lx0.bkt.clouddn.com/savePhotoBrower.gif" alt="saveSuccess"></p>
<p>不允许访问相册，保存失败</p>
<p><img src="http://o8bxt3lx0.bkt.clouddn.com/savePhotoBrower_deni.gif" alt="saveFailes"></p>
<p>这个ActionSheet是我自己定义的一个简单的actionsheet<br>具体可以查看这篇文章：</p>
<p><a href="http://ppsheep.com/2016/10/24/iOS类似于微信的ActionSheet/" target="_blank" rel="external">http://ppsheep.com/2016/10/24/iOS类似于微信的ActionSheet/</a></p>
<p>在展示大图时 给PhotoScrollView添加一个长按手势</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#pragma mark - 添加手势</div><div class="line">- (void)addCustomGestureRecognizer:(UIView *)targetView&#123;</div><div class="line">    //单击手势</div><div class="line">    UITapGestureRecognizer *photoTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(photoTap:)];</div><div class="line">    //双击手势</div><div class="line">    UITapGestureRecognizer *zonmTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(zonmTap:)];</div><div class="line">    zonmTap.numberOfTapsRequired = 2;</div><div class="line">    [targetView addGestureRecognizer:photoTap];</div><div class="line">    [targetView addGestureRecognizer:zonmTap];</div><div class="line">    [photoTap requireGestureRecognizerToFail:zonmTap];</div><div class="line">    //长按手势</div><div class="line">    UILongPressGestureRecognizer *longPress = [[UILongPressGestureRecognizer alloc] initWithTarget:self action:@selector(savePhoto:)];</div><div class="line">    [longPress requireGestureRecognizerToFail:zonmTap];</div><div class="line">    [longPress requireGestureRecognizerToFail:photoTap];</div><div class="line">    [targetView addGestureRecognizer:longPress];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在ActionSheet的代理中  保存图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#pragma mark - PPSActionSheetDelegate</div><div class="line">-(void)actionSheet:(PPSActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex&#123;</div><div class="line">    if (buttonIndex == 1) &#123;</div><div class="line">        Photo *photo = self.photos[self.currentIndex];</div><div class="line">        if (photo.image) &#123; //保证图片存在 已经下载完成</div><div class="line">            //判断是否有访问相册权限</div><div class="line">            PHAuthorizationStatus status = [PHPhotoLibrary authorizationStatus];</div><div class="line">            if (status == PHAuthorizationStatusRestricted ||</div><div class="line">                status == PHAuthorizationStatusDenied) &#123;</div><div class="line">                //没有权限 拒绝</div><div class="line">                UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@&quot;提示&quot; message:@&quot;没有访问相册的权限&quot; delegate:self cancelButtonTitle:nil otherButtonTitles:@&quot;确定&quot;, nil];</div><div class="line">                [alert show];</div><div class="line">            &#125;else&#123;</div><div class="line">                UIImageWriteToSavedPhotosAlbum(photo.image, self, @selector(image:didFinishSavingWithError:contextInfo:), nil);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在保存图片的时候 需要注意一点就是  需要判断权限是否 存在   </p>
<font color="red">特别是在iOS的时候 访问相机 相册 都需要在info里加上权限 具体可以百度一下 相册权限字段描述是 Privacy - Photo Library Usage Description</font>

<p>好了 一个 基本的图片浏览器 就完成了</p>
<p>项目的源码放在：</p>
<p><a href="https://github.com/yangqian111/blog/tree/master/iOS图片查看器" target="_blank" rel="external">https://github.com/yangqian111/blog/tree/master/iOS图片查看器</a></p>
<h3 id="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"><a href="#欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧" class="headerlink" title="欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧"></a>欢迎大家关注我的公众号，主要是分享一些我在项目中遇到问题的解决方法，还有一些实用技巧</h3><p><img src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg" alt=""></p>
<h3 id="文章也会同步到我的个人博客："><a href="#文章也会同步到我的个人博客：" class="headerlink" title="文章也会同步到我的个人博客："></a>文章也会同步到我的个人博客：</h3><p><a href="http://ppsheep.com" target="_blank" rel="external">http://ppsheep.com</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://o8bxt3lx0.bkt.clouddn.com/avatar_public.jpg"
               alt="sheep" />
          <p class="site-author-name" itemprop="name">sheep</p>
          <p class="site-description motion-element" itemprop="description">嘘_sheep</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sheep</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"yangqian111"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("wVNXI1zodIQXjH2YGmNdcNTR-gzGzoHsz", "qglLYXNVHBDUayaqz0RYy6H4");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
